<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title></title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>Load libraries.</p>

<pre><code class="r">library(dplyr)
</code></pre>

<pre><code>## 
## Attaching package: &#39;dplyr&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
</code></pre>

<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</code></pre>

<pre><code class="r">library(GenomicRanges)
</code></pre>

<pre><code>## Loading required package: stats4
</code></pre>

<pre><code>## Loading required package: BiocGenerics
</code></pre>

<pre><code>## Loading required package: parallel
</code></pre>

<pre><code>## 
## Attaching package: &#39;BiocGenerics&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:parallel&#39;:
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB
</code></pre>

<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     combine, intersect, setdiff, union
</code></pre>

<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     IQR, mad, sd, var, xtabs
</code></pre>

<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     anyDuplicated, append, as.data.frame, cbind, colMeans,
##     colnames, colSums, do.call, duplicated, eval, evalq, Filter,
##     Find, get, grep, grepl, intersect, is.unsorted, lapply,
##     lengths, Map, mapply, match, mget, order, paste, pmax,
##     pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce,
##     rowMeans, rownames, rowSums, sapply, setdiff, sort, table,
##     tapply, union, unique, unsplit, which, which.max, which.min
</code></pre>

<pre><code>## Loading required package: S4Vectors
</code></pre>

<pre><code>## 
## Attaching package: &#39;S4Vectors&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, rename
</code></pre>

<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     expand.grid
</code></pre>

<pre><code>## Loading required package: IRanges
</code></pre>

<pre><code>## 
## Attaching package: &#39;IRanges&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     collapse, desc, slice
</code></pre>

<pre><code>## Loading required package: GenomeInfoDb
</code></pre>

<p>Placeholder - Evan to set this dynamically in the future based on where the person is putting FusionVis.</p>

<p>This is so we can read in all the annotation Rdata files.</p>

<pre><code class="r">installation_dir_FusionVis &lt;- &quot;/nethome/hmgeiger/FusionViz&quot;
</code></pre>

<p>This script will accept as arguments the full path to a fusion detection program output, and arguments for genome (GRCh37/GRCh38) and program (STAR-Fusion/FusionCatcher).</p>

<p>Also an output directory.</p>

<p>For this documentation, I will hard code these values instead of reading in from command line.</p>

<pre><code class="r">#Read in test file from subdirectory under FusionVis directory.
#This is also where we will put the output.

fusion_file &lt;- paste0(installation_dir_FusionVis,&quot;/visualize_incl_GenomicRanges_test/FusionCatcher_output_test.txt&quot;)
fusion_program &lt;- &quot;FusionCatcher&quot;
genome &lt;- &quot;GRCh37&quot;
output_dir &lt;- paste0(installation_dir_FusionVis,&quot;/visualize_incl_GenomicRanges_test&quot;)
</code></pre>

<p>Load different annotation Rdata files depending on genome version specified.</p>

<p>Still need to make the ones for GRCh38.</p>

<pre><code class="r">if(genome == &quot;GRCh37&quot;)
{
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_exons_as_data_frame.Rdata&quot;))
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_exons_as_GRanges.Rdata&quot;))
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_introns_as_GRanges.Rdata&quot;))
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_total_exons_per_transcript.Rdata&quot;))
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_rank_per_transcript.Rdata&quot;))
load(paste0(installation_dir_FusionVis,&quot;/annotation/biomart_db_GRCh37_utrs_for_plotting.Rdata&quot;))
}

#Will eventually have similar files to read in for GRCh38.
#For now, exit with an error if genome is GRCh38.

if(genome == &quot;GRCh38&quot;)
{
print(&quot;Program does not currently have GRCh38 annotation available. Exiting&quot;)
quit()
}
</code></pre>

<p>Let&#39;s explore these annotation files a bit.</p>

<p>Some are data frames, some are GRanges which are useful for quickly intersecting coordinates.</p>

<pre><code class="r">#List all objects, which will show our command line arguments plus everything we just loaded from Rdata files.

ls()
</code></pre>

<pre><code>##  [1] &quot;exons_as_data_frame&quot;          &quot;exons_as_GRanges&quot;            
##  [3] &quot;fusion_file&quot;                  &quot;fusion_program&quot;              
##  [5] &quot;genome&quot;                       &quot;installation_dir_FusionVis&quot;  
##  [7] &quot;introns_as_GRanges&quot;           &quot;output_dir&quot;                  
##  [9] &quot;total_exons_per_transcript&quot;   &quot;transcript_info&quot;             
## [11] &quot;utrs_data_frame_for_plotting&quot;
</code></pre>

<pre><code class="r">#Let&#39;s show the GRanges objects first.
#We have one for all annotated exons and one for all annotated introns.

exons_as_GRanges
</code></pre>

<pre><code>## GRanges object with 1306656 ranges and 3 metadata columns:
##                     seqnames         ranges strand |   exon_id
##                        &lt;Rle&gt;      &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt;
##   ENST00000456328          1 [11869, 12227]      + |         1
##   ENST00000456328          1 [12613, 12721]      + |         8
##   ENST00000456328          1 [13221, 14409]      + |        12
##   ENST00000515242          1 [11872, 12227]      + |         2
##   ENST00000515242          1 [12613, 12721]      + |         9
##               ...        ...            ...    ... .       ...
##   ENST00000476361 GL000243.1 [ 8050,  8132]      + |    738005
##   ENST00000580872 GL000247.1 [10271, 10353]      - |    738006
##   ENST00000459271 GL000247.1 [11746, 11828]      - |    738007
##   ENST00000458778 GL000247.1 [11986, 12067]      - |    738008
##   ENST00000606635 GL000247.1 [12803, 12884]      - |    738009
##                         exon_name exon_rank
##                       &lt;character&gt; &lt;integer&gt;
##   ENST00000456328 ENSE00002234944         1
##   ENST00000456328 ENSE00003582793         2
##   ENST00000456328 ENSE00002312635         3
##   ENST00000515242 ENSE00002234632         1
##   ENST00000515242 ENSE00003608237         2
##               ...             ...       ...
##   ENST00000476361 ENSE00001877993         1
##   ENST00000580872 ENSE00002691431         1
##   ENST00000459271 ENSE00001814171         1
##   ENST00000458778 ENSE00001807025         1
##   ENST00000606635 ENSE00003700638         1
##   -------
##   seqinfo: 297 sequences (1 circular) from an unspecified genome
</code></pre>

<pre><code class="r">introns_as_GRanges
</code></pre>

<pre><code>## GRanges object with 1091486 ranges and 0 metadata columns:
##                     seqnames         ranges strand
##                        &lt;Rle&gt;      &lt;IRanges&gt;  &lt;Rle&gt;
##   ENST00000456328          1 [12228, 12612]      +
##   ENST00000456328          1 [12722, 13220]      +
##   ENST00000515242          1 [12228, 12612]      +
##   ENST00000515242          1 [12722, 13224]      +
##   ENST00000518655          1 [12228, 12594]      +
##               ...        ...            ...    ...
##   ENST00000368515 GL000228.1 [31738, 31995]      -
##   ENST00000602027 GL000237.1 [ 1004,  2472]      -
##   ENST00000507732 GL000242.1 [14377, 17444]      +
##   ENST00000507732 GL000242.1 [17533, 23600]      +
##   ENST00000507732 GL000242.1 [26367, 34083]      +
##   -------
##   seqinfo: 297 sequences (1 circular) from an unspecified genome
</code></pre>

<pre><code class="r">#Next, show the exons data frame.

head(exons_as_data_frame)
</code></pre>

<pre><code>##            TXNAME  CDSSTART    CDSEND EXONCHROM EXONSTRAND EXONSTART
## 1 ENST00000000233 127228553 127228619         7          + 127228399
## 2 ENST00000000233 127229137 127229217         7          + 127229137
## 3 ENST00000000233 127229539 127229648         7          + 127229539
## 4 ENST00000000233 127230120 127230191         7          + 127230120
## 5 ENST00000000233 127231017 127231142         7          + 127231017
## 6 ENST00000000233 127231267 127231353         7          + 127231267
##     EXONEND EXONRANK CDSLENGTH EXONLENGTH
## 1 127228619        1        67        221
## 2 127229217        2        81         81
## 3 127229648        3       110        110
## 4 127230191        4        72         72
## 5 127231142        5       126        126
## 6 127231759        6        87        493
</code></pre>

<pre><code class="r">head(exons_as_data_frame[which(exons_as_data_frame$EXONSTRAND == &quot;-&quot;),])
</code></pre>

<pre><code>##             TXNAME CDSSTART  CDSEND EXONCHROM EXONSTRAND EXONSTART EXONEND
## 7  ENST00000000412  9095012 9095138        12          -   9095012 9095138
## 8  ENST00000000412  9098825 9099000        12          -   9098825 9099001
## 9  ENST00000000412  9098014 9098180        12          -   9098014 9098180
## 10 ENST00000000412       NA      NA        12          -   9102084 9102551
## 11 ENST00000000412  9096397 9096506        12          -   9096397 9096506
## 12 ENST00000000412  9096001 9096131        12          -   9096001 9096131
##    EXONRANK CDSLENGTH EXONLENGTH
## 7         6       127        127
## 8         2       176        177
## 9         3       167        167
## 10        1        NA        468
## 11        4       110        110
## 12        5       131        131
</code></pre>

<pre><code class="r">dim(exons_as_data_frame)
</code></pre>

<pre><code>## [1] 1306656      10
</code></pre>

<pre><code class="r">length(unique(exons_as_data_frame$TXNAME))
</code></pre>

<pre><code>## [1] 215170
</code></pre>

<pre><code class="r">#What about the transcript info file?

head(transcript_info)
</code></pre>

<pre><code>##                 external_gene_name ensembl_transcript_id
## ENST00000589042                TTN       ENST00000589042
## ENST00000591111                TTN       ENST00000591111
## ENST00000342992                TTN       ENST00000342992
## ENST00000342175                TTN       ENST00000342175
## ENST00000359218                TTN       ENST00000359218
## ENST00000460472                TTN       ENST00000460472
##                 transcript_biotype cds_length transcript_length coding
## ENST00000589042     protein_coding     107976            109224      1
## ENST00000591111     protein_coding     103053            104301      1
## ENST00000342992     protein_coding     100272            101518      1
## ENST00000342175     protein_coding      81357             82605      1
## ENST00000359218     protein_coding      81156             82404      1
## ENST00000460472     protein_coding      80781             82029      1
</code></pre>

<pre><code class="r">dim(transcript_info)
</code></pre>

<pre><code>## [1] 215170      6
</code></pre>

<pre><code class="r">#Related - a simple two column file giving the total number of exons per transcript (should probably combine this with transcript_info).

head(total_exons_per_transcript)
</code></pre>

<pre><code>##            TXNAME TotalExonNum
## 1 ENST00000000233            6
## 2 ENST00000000412            7
## 3 ENST00000000442            7
## 4 ENST00000001008           10
## 5 ENST00000001146            6
## 6 ENST00000002125           10
</code></pre>

<pre><code class="r">dim(total_exons_per_transcript)
</code></pre>

<pre><code>## [1] 215170      2
</code></pre>

<pre><code class="r">#Finally, we have a file which for all transcripts that have UTR(s), shows in which exons those UTRs fall, and how far into the exon they are if the boundaries are not right at the start or end of the exon.

head(utrs_data_frame_for_plotting)
</code></pre>

<pre><code>##   Breakpoint      Transcript ExonicOrNot ExonInOrBefore TotalExonNum
## 1  127228552 ENST00000000233         yes              1            6
## 2  127231354 ENST00000000233         yes              6            6
## 3    9099001 ENST00000000412         yes              2            7
## 4    9094413 ENST00000000412         yes              7            7
## 5   64074651 ENST00000000442         yes              2            7
## 6   64083439 ENST00000000442         yes              7            7
##   StartMiddleEnd LengthIntoExon PercentIntoExon
## 1         Middle            154       69.683258
## 2         Middle             88       17.849899
## 3          Start             NA              NA
## 4         Middle            124        7.868020
## 5         Middle             12        3.560831
## 6         Middle            261       25.290698
</code></pre>

<pre><code class="r">dim(utrs_data_frame_for_plotting)
</code></pre>

<pre><code>## [1] 167321      8
</code></pre>

<pre><code class="r">length(unique(utrs_data_frame_for_plotting$Transcript))
</code></pre>

<pre><code>## [1] 99869
</code></pre>

<p>Now, let&#39;s read in the fusion program output.</p>

<p>Both FusionCatcher and STAR-Fusion will be read in the same way.</p>

<pre><code class="r">fusion_file &lt;- read.table(fusion_file,header=TRUE,sep=&quot;\t&quot;,comment.char=&quot;&quot;,quote=&quot;&quot;,check.names=FALSE,stringsAsFactors=FALSE)
</code></pre>

<p>If FusionCatcher, breakpoints are called &ldquo;Fusion_point_for_gene_1(5end_fusion_partner)&rdquo; and &ldquo;Fusion_point_for_gene_2(3end_fusion_partner)&rdquo;.</p>

<p>If STAR-Fusion, breakpoints are called &ldquo;LeftBreakpoint&rdquo; and &ldquo;RightBreakpoint&rdquo;.</p>

<p>Both are in format chr:breakpoint:strand.</p>

<p>Fusioncatcher geneA and geneB are called &ldquo;Gene_1_symbol(5end_fusion_partner)&rdquo; and &ldquo;Gene_2_symbol(3end_fusion_partner)&rdquo;.</p>

<p>STAR-Fusion field &ldquo;#FusionName&rdquo; = GeneA&ndash;GeneB.</p>

<p>Fusioncatcher is unique in having another field that is per gene combination called &ldquo;description&rdquo;, that tells whether the fusion is normally found in healthy or cancer samples, etc.</p>

<p>Then, both programs have a few fields that are specific to each breakpoint combination, rather than each gene combination.</p>

<p>FusionCatcher: &ldquo;Spanning_pairs&rdquo;,&ldquo;Spanning_unique_reads&rdquo;,&ldquo;Predicted_effect&rdquo;</p>

<p>STAR-Fusion: &ldquo;JunctionReadCount&rdquo;,&ldquo;SpanningFragCount&rdquo;,&ldquo;SpliceType&rdquo;</p>

<pre><code class="r">if(fusion_program == &quot;FusionCatcher&quot;)
{
breakpoints_geneA &lt;- fusion_file[,&quot;Fusion_point_for_gene_1(5end_fusion_partner)&quot;]
breakpoints_geneB &lt;- fusion_file[,&quot;Fusion_point_for_gene_2(3end_fusion_partner)&quot;]
geneA_plus_geneB_names &lt;- paste0(fusion_file[,&quot;Gene_1_symbol(5end_fusion_partner)&quot;],&quot;--&quot;,fusion_file[,&quot;Gene_2_symbol(3end_fusion_partner)&quot;])
in_frame_vs_not &lt;- rep(&quot;Not in-frame&quot;,times=nrow(fusion_file))
in_frame_vs_not[which(fusion_file[,&quot;Predicted_effect&quot;] == &quot;in-frame&quot;)] &lt;- &quot;in-frame&quot;
descriptions_per_fusion &lt;- fusion_file[,&quot;Fusion_description&quot;]
#Here put information we do not technically need to make the plot, but that may be useful to know (like number of supporting reads).
#This contains breakpoint-specific information.
other_info_to_possibly_display &lt;- paste0(&quot;Spanning.pairs=&quot;,fusion_file[,&quot;Spanning_pairs&quot;],&quot;;Spanning.unique.reads=&quot;,fusion_file[,&quot;Spanning_unique_reads&quot;],&quot;;Predicted.effect=&quot;,fusion_file[,&quot;Predicted_effect&quot;])
}

if(fusion_program == &quot;STAR-Fusion&quot;)
{
breakpoints_geneA &lt;- fusion_file[,&quot;LeftBreakpoint&quot;]
breakpoints_geneB &lt;- fusion_file[,&quot;RightBreakpoint&quot;]
geneA_plus_geneB_names &lt;- fusion_file[,&quot;#FusionName&quot;]
#STAR-Fusion does not output anything equivalent to in-frame from FusionCatcher. So, will not be able to color by in-frame vs. not for STAR-Fusion, so just make NA.
in_frame_vs_not &lt;- rep(NA,times=nrow(fusion_file))
#STAR-Fusion also does not output any description, so just leave a blank for description for those outputs.
descriptions_per_fusion &lt;- rep(&quot;No description&quot;,times=nrow(fusion_file))
#Again, we put information that we do not technically need to make the plot, but that may be useful to know, in other_info_to_possibly_display.
other_info_to_possibly_display &lt;- paste0(&quot;JunctionReadCount=&quot;,fusion_file[,&quot;JunctionReadCount&quot;],&quot;;SpanningFragCount=&quot;,fusion_file[,&quot;SpanningFragCount&quot;],&quot;;SpliceType=&quot;,fusion_file[,&quot;SpliceType&quot;])
}
</code></pre>

<p>Now, we put all of these values we just obtained into a data frame, and display the first few rows.</p>

<pre><code class="r">fusion_file_main_info &lt;- data.frame(GeneA.GeneB = geneA_plus_geneB_names,FusionDescription = descriptions_per_fusion,GeneA.Breakpoint = breakpoints_geneA,GeneB.Breakpoint = breakpoints_geneB,In.frame.status = in_frame_vs_not,Other.breakpoint.specific.info = other_info_to_possibly_display,stringsAsFactors=FALSE)

head(fusion_file_main_info)
</code></pre>

<pre><code>##     GeneA.GeneB
## 1    MGA--NUTM1
## 2    MGA--NUTM1
## 3 FAM175A--HELQ
## 4 FAM175A--HELQ
## 5 FAM175A--HELQ
## 6 FAM175A--HELQ
##                                                        FusionDescription
## 1                                                                       
## 2                                                                       
## 3 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 4 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 5 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 6 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
##   GeneA.Breakpoint GeneB.Breakpoint In.frame.status
## 1    15:42054560:+    15:34640170:+        in-frame
## 2    15:42054048:+    15:34640170:+        in-frame
## 3     4:84384647:-     4:84375098:-    Not in-frame
## 4     4:84397796:-     4:84375098:-    Not in-frame
## 5     4:84403307:-     4:84375098:-        in-frame
## 6     4:84391356:-     4:84375098:-    Not in-frame
##                                             Other.breakpoint.specific.info
## 1    Spanning.pairs=146;Spanning.unique.reads=37;Predicted.effect=in-frame
## 2     Spanning.pairs=146;Spanning.unique.reads=4;Predicted.effect=in-frame
## 3 Spanning.pairs=27;Spanning.unique.reads=16;Predicted.effect=out-of-frame
## 4  Spanning.pairs=27;Spanning.unique.reads=2;Predicted.effect=out-of-frame
## 5      Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=in-frame
## 6  Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=out-of-frame
</code></pre>

<p>Get chromosome, coordinate, and strand from breakpoints_geneA and breakpoints_geneB using the strsplit function to separate the fields separated by &ldquo;:&rdquo;.</p>

<pre><code class="r">breakpoints_geneA_data_frame &lt;- data.frame(chr = sapply(strsplit(breakpoints_geneA,&quot;:&quot;),&quot;[[&quot;,1),coordinate = sapply(strsplit(breakpoints_geneA,&quot;:&quot;),&quot;[[&quot;,2),strand = sapply(strsplit(breakpoints_geneA,&quot;:&quot;),&quot;[[&quot;,3),Breakpoint.string = breakpoints_geneA,stringsAsFactors=FALSE)
breakpoints_geneA_data_frame$coordinate &lt;- as.numeric(as.vector(breakpoints_geneA_data_frame$coordinate))

breakpoints_geneB_data_frame &lt;- data.frame(chr = sapply(strsplit(breakpoints_geneB,&quot;:&quot;),&quot;[[&quot;,1),coordinate = sapply(strsplit(breakpoints_geneB,&quot;:&quot;),&quot;[[&quot;,2),strand = sapply(strsplit(breakpoints_geneB,&quot;:&quot;),&quot;[[&quot;,3),Breakpoint.string = breakpoints_geneB,stringsAsFactors=FALSE)
breakpoints_geneB_data_frame$coordinate &lt;- as.numeric(as.vector(breakpoints_geneB_data_frame$coordinate))

head(breakpoints_geneA_data_frame)
</code></pre>

<pre><code>##   chr coordinate strand Breakpoint.string
## 1  15   42054560      +     15:42054560:+
## 2  15   42054048      +     15:42054048:+
## 3   4   84384647      -      4:84384647:-
## 4   4   84397796      -      4:84397796:-
## 5   4   84403307      -      4:84403307:-
## 6   4   84391356      -      4:84391356:-
</code></pre>

<pre><code class="r">head(breakpoints_geneB_data_frame)
</code></pre>

<pre><code>##   chr coordinate strand Breakpoint.string
## 1  15   34640170      +     15:34640170:+
## 2  15   34640170      +     15:34640170:+
## 3   4   84375098      -      4:84375098:-
## 4   4   84375098      -      4:84375098:-
## 5   4   84375098      -      4:84375098:-
## 6   4   84375098      -      4:84375098:-
</code></pre>

<p>In this version of the script, I am now using Ensembl annotation, which does not have &ldquo;chr&rdquo; prefix on chromosomes.</p>

<p>Check the breakpoints and see if they have &ldquo;chr&rdquo; prefix. If so, auto remove it to make compatible with annotation.</p>

<pre><code class="r">if(length(grep(&#39;chr&#39;,breakpoints_geneA_data_frame$chr[1])) == 1)
{
breakpoints_geneA_data_frame$chr &lt;- sapply(strsplit(breakpoints_geneA_data_frame$chr,&quot;chr&quot;),&quot;[[&quot;,2)
breakpoints_geneB_data_frame$chr &lt;- sapply(strsplit(breakpoints_geneB_data_frame$chr,&quot;chr&quot;),&quot;[[&quot;,2)
}
</code></pre>

<p>Now, make a GRanges object out of each of the two breakpoint data frames.</p>

<pre><code class="r">breakpoints_geneA_GRanges &lt;- GRanges(seqnames = breakpoints_geneA_data_frame$chr,
ranges = IRanges(breakpoints_geneA_data_frame$coordinate,breakpoints_geneA_data_frame$coordinate),
name = breakpoints_geneA_data_frame$Breakpoint.string,
strand = breakpoints_geneA_data_frame$strand)

breakpoints_geneB_GRanges &lt;- GRanges(seqnames = breakpoints_geneB_data_frame$chr,
ranges = IRanges(breakpoints_geneB_data_frame$coordinate,breakpoints_geneB_data_frame$coordinate),
name = breakpoints_geneB_data_frame$Breakpoint.string,
strand = breakpoints_geneB_data_frame$strand)

breakpoints_geneA_GRanges
</code></pre>

<pre><code>## GRanges object with 109 ranges and 1 metadata column:
##         seqnames               ranges strand |          name
##            &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt;
##     [1]       15 [42054560, 42054560]      + | 15:42054560:+
##     [2]       15 [42054048, 42054048]      + | 15:42054048:+
##     [3]        4 [84384647, 84384647]      - |  4:84384647:-
##     [4]        4 [84397796, 84397796]      - |  4:84397796:-
##     [5]        4 [84403307, 84403307]      - |  4:84403307:-
##     ...      ...                  ...    ... .           ...
##   [105]       11 [61135470, 61135470]      + | 11:61135470:+
##   [106]       17 [ 7464884,  7464884]      + |  17:7464884:+
##   [107]       17 [ 7464884,  7464884]      + |  17:7464884:+
##   [108]       19 [57011616, 57011616]      + | 19:57011616:+
##   [109]        3 [44552045, 44552045]      - |  3:44552045:-
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths
</code></pre>

<pre><code class="r">breakpoints_geneB_GRanges
</code></pre>

<pre><code>## GRanges object with 109 ranges and 1 metadata column:
##         seqnames               ranges strand |          name
##            &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt;
##     [1]       15 [34640170, 34640170]      + | 15:34640170:+
##     [2]       15 [34640170, 34640170]      + | 15:34640170:+
##     [3]        4 [84375098, 84375098]      - |  4:84375098:-
##     [4]        4 [84375098, 84375098]      - |  4:84375098:-
##     [5]        4 [84375098, 84375098]      - |  4:84375098:-
##     ...      ...                  ...    ... .           ...
##   [105]       11 [61160236, 61160236]      + | 11:61160236:+
##   [106]       17 [ 7487236,  7487236]      + |  17:7487236:+
##   [107]       17 [ 7487236,  7487236]      + |  17:7487236:+
##   [108]       19 [57022886, 57022886]      + | 19:57022886:+
##   [109]        3 [44499856, 44499856]      - |  3:44499856:-
##   -------
##   seqinfo: 21 sequences from an unspecified genome; no seqlengths
</code></pre>

<p>Overlap these with exon GRanges.</p>

<p>Then, output the relevant info, including the transcript name plus which exon it matched up to.</p>

<pre><code class="r">overlaps_transcript_exon_coords_and_breakpoints_geneA &lt;- mergeByOverlaps(exons_as_GRanges,breakpoints_geneA_GRanges,maxgap=-1L)

overlaps_transcript_exon_coords_and_breakpoints_geneA
</code></pre>

<pre><code>## DataFrame with 414 rows and 6 columns
##          exons_as_GRanges   exon_id       exon_name exon_rank
##                 &lt;GRanges&gt; &lt;integer&gt;     &lt;character&gt; &lt;integer&gt;
## 1   1:27094281-27094490:+      5567 ENSE00001349752        11
## 2   1:27094281-27094490:+      5567 ENSE00001349752        11
## 3   1:27094281-27094490:+      5567 ENSE00001349752        10
## 4   1:27094281-27094492:+      5568 ENSE00001698973         2
## 5   1:53072356-53072617:+     10661 ENSE00000835736         2
## ...                   ...       ...             ...       ...
## 410 X:63564925-63565057:-    665840 ENSE00003624461         7
## 411 X:63564925-63565038:-    665838 ENSE00001949212         1
## 412 X:63564925-63565057:-    665839 ENSE00003463397         3
## 413 Y:15815447-15816315:+    672004 ENSE00001016870         1
## 414 Y:15815447-15816315:+    672004 ENSE00001016870         1
##     breakpoints_geneA_GRanges         name
##                     &lt;GRanges&gt;  &lt;character&gt;
## 1                1:27094490:+ 1:27094490:+
## 2                1:27094490:+ 1:27094490:+
## 3                1:27094490:+ 1:27094490:+
## 4                1:27094490:+ 1:27094490:+
## 5                1:53072617:+ 1:53072617:+
## ...                       ...          ...
## 410              X:63564925:- X:63564925:-
## 411              X:63564925:- X:63564925:-
## 412              X:63564925:- X:63564925:-
## 413              Y:15816315:+ Y:15816315:+
## 414              Y:15816315:+ Y:15816315:+
</code></pre>

<pre><code class="r">overlaps_transcript_exon_coords_and_breakpoints_geneA$exons_as_GRanges
</code></pre>

<pre><code>## GRanges object with 414 ranges and 3 metadata columns:
##                   seqnames               ranges strand |   exon_id
##                      &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt;
##   ENST00000324856        1 [27094281, 27094490]      + |      5567
##   ENST00000457599        1 [27094281, 27094490]      + |      5567
##   ENST00000374152        1 [27094281, 27094490]      + |      5567
##   ENST00000430291        1 [27094281, 27094492]      + |      5568
##   ENST00000361314        1 [53072356, 53072617]      + |     10661
##               ...      ...                  ...    ... .       ...
##   ENST00000374852        X [63564925, 63565057]      - |    665840
##   ENST00000478487        X [63564925, 63565038]      - |    665838
##   ENST00000461403        X [63564925, 63565057]      - |    665839
##   ENST00000284856        Y [15815447, 15816315]      + |    672004
##   ENST00000284856        Y [15815447, 15816315]      + |    672004
##                         exon_name exon_rank
##                       &lt;character&gt; &lt;integer&gt;
##   ENST00000324856 ENSE00001349752        11
##   ENST00000457599 ENSE00001349752        11
##   ENST00000374152 ENSE00001349752        10
##   ENST00000430291 ENSE00001698973         2
##   ENST00000361314 ENSE00000835736         2
##               ...             ...       ...
##   ENST00000374852 ENSE00003624461         7
##   ENST00000478487 ENSE00001949212         1
##   ENST00000461403 ENSE00003463397         3
##   ENST00000284856 ENSE00001016870         1
##   ENST00000284856 ENSE00001016870         1
##   -------
##   seqinfo: 297 sequences (1 circular) from an unspecified genome
</code></pre>

<pre><code class="r">overlaps_transcript_exon_coords_and_breakpoints_geneA$breakpoints_geneA_GRanges
</code></pre>

<pre><code>## GRanges object with 414 ranges and 1 metadata column:
##         seqnames               ranges strand |         name
##            &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt; |  &lt;character&gt;
##     [1]        1 [27094490, 27094490]      + | 1:27094490:+
##     [2]        1 [27094490, 27094490]      + | 1:27094490:+
##     [3]        1 [27094490, 27094490]      + | 1:27094490:+
##     [4]        1 [27094490, 27094490]      + | 1:27094490:+
##     [5]        1 [53072617, 53072617]      + | 1:53072617:+
##     ...      ...                  ...    ... .          ...
##   [410]        X [63564925, 63564925]      - | X:63564925:-
##   [411]        X [63564925, 63564925]      - | X:63564925:-
##   [412]        X [63564925, 63564925]      - | X:63564925:-
##   [413]        Y [15816315, 15816315]      + | Y:15816315:+
##   [414]        Y [15816315, 15816315]      + | Y:15816315:+
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths
</code></pre>

<pre><code class="r">#Get two data frames for the exons_as_GRanges and breakpoints_geneA_GRanges part of the overlap object.

transcript_exon_coords_overlapping_breakpoints_geneA &lt;- BiocGenerics::as.data.frame(overlaps_transcript_exon_coords_and_breakpoints_geneA[,&quot;exons_as_GRanges&quot;],row.names=NULL)
breakpoint_geneA_coords_overlapping_transcript_exons &lt;- BiocGenerics::as.data.frame(overlaps_transcript_exon_coords_and_breakpoints_geneA[,&quot;breakpoints_geneA_GRanges&quot;],row.names=NULL)

exon_num_per_transcript_per_breakpoint_geneA &lt;- data.frame(Breakpoint.name = overlaps_transcript_exon_coords_and_breakpoints_geneA[,&quot;name&quot;],
TXNAME = names(overlaps_transcript_exon_coords_and_breakpoints_geneA$exons_as_GRanges), #We get the &quot;ENST&quot; names using the names function from GRanges now.
EXONRANK = as.numeric(as.vector(transcript_exon_coords_overlapping_breakpoints_geneA$exon_rank)),
EXONSTART = as.numeric(as.vector(transcript_exon_coords_overlapping_breakpoints_geneA$start)),
EXONEND = as.numeric(as.vector(transcript_exon_coords_overlapping_breakpoints_geneA$end)),
Breakpoint.coord = as.numeric(as.vector(breakpoint_geneA_coords_overlapping_transcript_exons$start)), #Get the breakpoint info as a numeric in addition to having the string.
stringsAsFactors=FALSE)

#We will see that in this initial overlap, the same breakpoint can match multiple transcripts.
head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##   Breakpoint.name          TXNAME EXONRANK EXONSTART  EXONEND
## 1    1:27094490:+ ENST00000324856       11  27094281 27094490
## 2    1:27094490:+ ENST00000457599       11  27094281 27094490
## 3    1:27094490:+ ENST00000374152       10  27094281 27094490
## 4    1:27094490:+ ENST00000430291        2  27094281 27094492
## 5    1:53072617:+ ENST00000361314        2  53072356 53072617
## 6    1:53072617:+ ENST00000459779        2  53072356 53073080
##   Breakpoint.coord
## 1         27094490
## 2         27094490
## 3         27094490
## 4         27094490
## 5         53072617
## 6         53072617
</code></pre>

<p>Similar code for geneB. Not going to show since this documentation is already quite long. :)</p>

<p>Let&#39;s also intersect with intron annotation.</p>

<p>Some fusion programs (like FusionCatcher) include fusions where the breakpoints are intronic.</p>

<pre><code class="r">overlaps_transcript_intron_coords_and_breakpoints_geneA &lt;- mergeByOverlaps(introns_as_GRanges,breakpoints_geneA_GRanges,maxgap=-1L)
transcript_intron_coords_overlapping_breakpoints_geneA &lt;- BiocGenerics::as.data.frame(overlaps_transcript_intron_coords_and_breakpoints_geneA[,&quot;introns_as_GRanges&quot;],row.names=NULL)
breakpoint_geneA_coords_overlapping_transcript_introns &lt;- BiocGenerics::as.data.frame(overlaps_transcript_intron_coords_and_breakpoints_geneA[,&quot;breakpoints_geneA_GRanges&quot;],row.names=NULL)

intron_per_transcript_per_breakpoint_geneA &lt;- data.frame(Breakpoint.name = overlaps_transcript_intron_coords_and_breakpoints_geneA[,&quot;name&quot;],
 TXNAME = names(overlaps_transcript_intron_coords_and_breakpoints_geneA$introns_as_GRanges),
 INTRONSTART = as.numeric(as.vector(transcript_intron_coords_overlapping_breakpoints_geneA$start)),
 INTRONEND = as.numeric(as.vector(transcript_intron_coords_overlapping_breakpoints_geneA$end)),
 Breakpoint.coord = as.numeric(as.vector(breakpoint_geneA_coords_overlapping_transcript_introns$start)),
 stringsAsFactors=FALSE)
</code></pre>

<p>Repeat for gene B (not shown).</p>

<p>Now, choose the best transcript to represent each breakpoint.</p>

<p>First, we need to separate breakpoints that can be represented within exons, from those that are only in introns, from those that do not overlap either (and thus are &ldquo;incompatible annotation&rdquo;).</p>

<p>Some breakpoints may overlap both exons and introns (of different transcripts), in which case we would rather use the exon to represent the breakpoint.</p>

<pre><code class="r">#How many unique geneA/geneB breakpoints are there?
dim(fusion_file_main_info)
</code></pre>

<pre><code>## [1] 109   6
</code></pre>

<pre><code class="r">length(unique(fusion_file_main_info$GeneA.Breakpoint))
</code></pre>

<pre><code>## [1] 97
</code></pre>

<pre><code class="r">length(unique(fusion_file_main_info$GeneB.Breakpoint))
</code></pre>

<pre><code>## [1] 88
</code></pre>

<pre><code class="r">#How many geneA and geneB breakpoints overlap exons?
geneA_breakpoints_overlapping_exons &lt;- unique(exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.name)
geneB_breakpoints_overlapping_exons &lt;- unique(exon_num_per_transcript_per_breakpoint_geneB$Breakpoint.name)

length(geneA_breakpoints_overlapping_exons)
</code></pre>

<pre><code>## [1] 92
</code></pre>

<pre><code class="r">length(geneB_breakpoints_overlapping_exons)
</code></pre>

<pre><code>## [1] 82
</code></pre>

<pre><code class="r">#Most breakpoints overlap exons, but a few do not.
#How many of these overlap introns, vs. not being found in the annotation at all?

geneA_breakpoints_overlapping_introns_only &lt;- setdiff(unique(intron_per_transcript_per_breakpoint_geneA$Breakpoint.name),geneA_breakpoints_overlapping_exons)
geneB_breakpoints_overlapping_introns_only &lt;- setdiff(unique(intron_per_transcript_per_breakpoint_geneB$Breakpoint.name),geneB_breakpoints_overlapping_exons)

length(geneA_breakpoints_overlapping_introns_only)
</code></pre>

<pre><code>## [1] 4
</code></pre>

<pre><code class="r">length(geneB_breakpoints_overlapping_introns_only)
</code></pre>

<pre><code>## [1] 6
</code></pre>

<pre><code class="r">#Looks like there is one geneA breakpoint that does not overlap any annotated exons or introns.
#Let&#39;s get the row number(s) where one or both genes has a breakpoint that does not overlap any annotated exons or introns.

geneA_breakpoints_incompatible_annotation &lt;- setdiff(unique(breakpoints_geneA),c(geneA_breakpoints_overlapping_exons,geneA_breakpoints_overlapping_introns_only))
geneB_breakpoints_incompatible_annotation &lt;- setdiff(unique(breakpoints_geneB),c(geneB_breakpoints_overlapping_exons,geneB_breakpoints_overlapping_introns_only))

incompatible_annotation_rows &lt;- c()
if(length(geneA_breakpoints_incompatible_annotation) &gt; 0){
    incompatible_annotation_rows &lt;- c(incompatible_annotation_rows,grep(paste0(geneA_breakpoints_incompatible_annotation,collapse=&quot;|&quot;),breakpoints_geneA))
}

if(length(geneB_breakpoints_incompatible_annotation) &gt; 0){
    incompatible_annotation_rows &lt;- c(incompatible_annotation_rows,grep(paste0(geneB_breakpoints_incompatible_annotation,collapse=&quot;|&quot;),breakpoints_geneB))
}

#Unique in case some rows have unannotated breakpoints for both geneA and geneB.

incompatible_annotation_rows &lt;- unique(incompatible_annotation_rows)

#Which row(s) are we skipping? Let&#39;s look at them in more detail.

fusion_file_main_info[incompatible_annotation_rows,]
</code></pre>

<pre><code>##      GeneA.GeneB   FusionDescription GeneA.Breakpoint GeneB.Breakpoint
## 61 KDELC2--EXPH5 adjacent,1K&lt;gap&lt;10K   11:108342816:-   11:108464231:-
##    In.frame.status
## 61    Not in-frame
##                                                         Other.breakpoint.specific.info
## 61 Spanning.pairs=4;Spanning.unique.reads=3;Predicted.effect=intergenic/CDS(truncated)
</code></pre>

<p>Now, we have all possible exons across all annotated transcripts matching up to each breakpoint.</p>

<p>We need to choose the best isoform for each breakpoint.</p>

<p>Match up the exon per breakpoint table to the &ldquo;transcript info&rdquo; table.</p>

<p>Then, prioritize coding over noncoding, then longer CDS, then longer transcript.</p>

<pre><code class="r">#Showing for geneA only.

exon_num_per_transcript_per_breakpoint_geneA &lt;- merge(exon_num_per_transcript_per_breakpoint_geneA,transcript_info,
    by.x=&quot;TXNAME&quot;,by.y = &quot;ensembl_transcript_id&quot;)

head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##            TXNAME Breakpoint.name EXONRANK EXONSTART  EXONEND
## 1 ENST00000006777    7:75513166:+        3  75513016 75513166
## 2 ENST00000216187   22:36886235:-        9  36884289 36886314
## 3 ENST00000219905   15:42054048:+       21  42053937 42054048
## 4 ENST00000219905   15:42054560:+       22  42054327 42054560
## 5 ENST00000223122     7:7278553:+        2   7277886  7278553
## 6 ENST00000223122     7:7283381:+        3   7283155  7288282
##   Breakpoint.coord external_gene_name transcript_biotype cds_length
## 1         75513166             RHBDD2     protein_coding       1095
## 2         36886235            FOXRED2     protein_coding       2055
## 3         42054048                MGA     protein_coding       9198
## 4         42054560                MGA     protein_coding       9198
## 5          7278553            C1GALT1     protein_coding       1092
## 6          7283381            C1GALT1     protein_coding       1092
##   transcript_length coding
## 1              1802      1
## 2              3933      1
## 3             12042      1
## 4             12042      1
## 5              6078      1
## 6              6078      1
</code></pre>

<pre><code class="r">#Remember that &quot;coding&quot; is 1 for protein coding, 0 otherwise.
#So can use reverse numerical sort to get coding first.

rank_transcripts_by_best_to_represent &lt;- order(exon_num_per_transcript_per_breakpoint_geneA$coding,
exon_num_per_transcript_per_breakpoint_geneA$cds_length,
exon_num_per_transcript_per_breakpoint_geneA$transcript_length,decreasing=TRUE)

exon_num_per_transcript_per_breakpoint_geneA &lt;- exon_num_per_transcript_per_breakpoint_geneA[rank_transcripts_by_best_to_represent,]

head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##              TXNAME Breakpoint.name EXONRANK EXONSTART  EXONEND
## 3   ENST00000219905   15:42054048:+       21  42053937 42054048
## 4   ENST00000219905   15:42054560:+       22  42054327 42054560
## 366 ENST00000570161   15:42054048:+       20  42053937 42054048
## 367 ENST00000570161   15:42054560:+       21  42054327 42054560
## 114 ENST00000389936   15:42054048:+       22  42053937 42054048
## 115 ENST00000389936   15:42054560:+       23  42054327 42054560
##     Breakpoint.coord external_gene_name transcript_biotype cds_length
## 3           42054048                MGA     protein_coding       9198
## 4           42054560                MGA     protein_coding       9198
## 366         42054048                MGA     protein_coding       9198
## 367         42054560                MGA     protein_coding       9198
## 114         42054048                MGA     protein_coding       9081
## 115         42054560                MGA     protein_coding       9081
##     transcript_length coding
## 3               12042      1
## 4               12042      1
## 366             11859      1
## 367             11859      1
## 114             11921      1
## 115             11921      1
</code></pre>

<pre><code class="r">#After this ordering, take the first occurence of each breakpoint.

exon_num_per_transcript_per_breakpoint_geneA &lt;- exon_num_per_transcript_per_breakpoint_geneA[which(
duplicated(exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.name) == FALSE),]
</code></pre>

<p>Similar for introns.</p>

<p>Except, first we remove from the intron table breakpoints that have matching exons.</p>

<pre><code class="r">#Remove breakpoints matching exons.

intron_per_transcript_per_breakpoint_geneA &lt;- merge(intron_per_transcript_per_breakpoint_geneA,
data.frame(Breakpoint.name = geneA_breakpoints_overlapping_introns_only),
by = &quot;Breakpoint.name&quot;)

intron_per_transcript_per_breakpoint_geneA &lt;- merge(intron_per_transcript_per_breakpoint_geneA,transcript_info,
    by.x=&quot;TXNAME&quot;,by.y = &quot;ensembl_transcript_id&quot;)

rank_transcripts_by_best_to_represent &lt;- order(intron_per_transcript_per_breakpoint_geneA$coding,
intron_per_transcript_per_breakpoint_geneA$cds_length,
intron_per_transcript_per_breakpoint_geneA$transcript_length,decreasing=TRUE)

intron_per_transcript_per_breakpoint_geneA &lt;- intron_per_transcript_per_breakpoint_geneA[rank_transcripts_by_best_to_represent,]

intron_per_transcript_per_breakpoint_geneA &lt;- intron_per_transcript_per_breakpoint_geneA[which(
duplicated(intron_per_transcript_per_breakpoint_geneA$Breakpoint.name) == FALSE),]
</code></pre>

<p>Repeat for gene B (not shown).</p>

<p>Now, we need to get the nearest exon for the intron annotation.</p>

<pre><code class="r">#Match up the intron coordinates with the exons data frame.
introns_geneA_find_exon_before &lt;- merge(intron_per_transcript_per_breakpoint_geneA,
exons_as_data_frame[,c(&quot;EXONSTRAND&quot;,&quot;EXONSTART&quot;,&quot;EXONEND&quot;,&quot;EXONRANK&quot;,&quot;TXNAME&quot;)],
by=&quot;TXNAME&quot;)

#If on positive strand, subtract one from the intron start. This will give EXONEND of the exon before.
#If on negative strand, add one to the intron end. This will give EXONSTART of the exon before.

indices_rows_where_intron_adjacent_to_exon &lt;- which((introns_geneA_find_exon_before$EXONSTRAND == &quot;+&quot; &amp; 
(introns_geneA_find_exon_before$INTRONSTART - 1) == introns_geneA_find_exon_before$EXONEND) | 
(introns_geneA_find_exon_before$EXONSTRAND == &quot;-&quot; &amp; 
(introns_geneA_find_exon_before$INTRONEND + 1) == introns_geneA_find_exon_before$EXONSTART)),]

introns_geneA_find_exon_before &lt;- introns_geneA_find_exon_before[indices_rows_where_intron_adjacent_to_exon,]

head(introns_geneA_find_exon_before)
</code></pre>

<pre><code>## Error: &lt;text&gt;:12:93: unexpected &#39;,&#39;
## 11: (introns_geneA_find_exon_before$EXONSTRAND == &quot;-&quot; &amp; 
## 12: (introns_geneA_find_exon_before$INTRONEND + 1) == introns_geneA_find_exon_before$EXONSTART)),
##                                                                                                 ^
</code></pre>

<p>Add additional info to exon table as well, mainly the strand information plus exon length for matching exons.</p>

<pre><code class="r">exon_num_per_transcript_per_breakpoint_geneA &lt;- merge(exon_num_per_transcript_per_breakpoint_geneA,
exons_as_data_frame[,c(&quot;TXNAME&quot;,&quot;EXONRANK&quot;,&quot;EXONSTRAND&quot;,&quot;EXONLENGTH&quot;)],
by=c(&quot;TXNAME&quot;,&quot;EXONRANK&quot;))

exon_num_per_transcript_per_breakpoint_geneB &lt;- merge(exon_num_per_transcript_per_breakpoint_geneB,
exons_as_data_frame[,c(&quot;TXNAME&quot;,&quot;EXONRANK&quot;,&quot;EXONSTRAND&quot;,&quot;EXONLENGTH&quot;)],
by=c(&quot;TXNAME&quot;,&quot;EXONRANK&quot;))

head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##            TXNAME EXONRANK Breakpoint.name EXONSTART   EXONEND
## 1 ENST00000006777        3    7:75513166:+  75513016  75513166
## 2 ENST00000219905       21   15:42054048:+  42053937  42054048
## 3 ENST00000219905       22   15:42054560:+  42054327  42054560
## 4 ENST00000225964       50   17:48263190:-  48263139  48263381
## 5 ENST00000260952        5   2:190532671:+ 190532490 190532671
## 6 ENST00000262293        9   17:57275150:+  57275054  57275150
##   Breakpoint.coord external_gene_name transcript_biotype cds_length
## 1         75513166             RHBDD2     protein_coding       1095
## 2         42054048                MGA     protein_coding       9198
## 3         42054560                MGA     protein_coding       9198
## 4         48263190             COL1A1     protein_coding       4395
## 5        190532671             ASNSD1     protein_coding       1932
## 6         57275150              PRR11     protein_coding       1083
##   transcript_length coding EXONSTRAND EXONLENGTH
## 1              1802      1          +        151
## 2             12042      1          +        112
## 3             12042      1          +        234
## 4              6727      1          -        243
## 5              2450      1          +        182
## 6              2332      1          +         97
</code></pre>

<p>Switch exon start and end if on negative strand.</p>

<pre><code class="r">geneA_new_exon_start_and_end &lt;- data.frame(
EXONSTART = exon_num_per_transcript_per_breakpoint_geneA$EXONSTART,
EXONEND = exon_num_per_transcript_per_breakpoint_geneA$EXONEND)

geneA_new_exon_start_and_end$EXONSTART &lt;- ifelse(exon_num_per_transcript_per_breakpoint_geneA$EXONSTRAND == &quot;+&quot;,
exon_num_per_transcript_per_breakpoint_geneA$EXONSTART,
exon_num_per_transcript_per_breakpoint_geneA$EXONEND)

geneA_new_exon_start_and_end$EXONEND &lt;- ifelse(exon_num_per_transcript_per_breakpoint_geneA$EXONSTRAND == &quot;+&quot;,
exon_num_per_transcript_per_breakpoint_geneA$EXONEND,
exon_num_per_transcript_per_breakpoint_geneA$EXONSTART)
</code></pre>

<p>Now, determine start, middle, or end and percent into exon based on distance from start or end.</p>

<pre><code class="r">geneA_matching_exon_start_middle_end &lt;- rep(&quot;Middle&quot;,
times=nrow(exon_num_per_transcript_per_breakpoint_geneA))

geneA_matching_exon_start_middle_end[which(
exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.coord == 
geneA_new_exon_start_and_end$EXONSTART)] &lt;- &quot;Start&quot;

geneA_matching_exon_start_middle_end[which(
exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.coord == 
geneA_new_exon_start_and_end$EXONEND)] &lt;- &quot;End&quot;

geneA_length_into_exon &lt;- abs(
exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.coord - 
geneA_new_exon_start_and_end$EXONSTART) + 1

geneA_length_into_exon[which(geneA_matching_exon_start_middle_end != &quot;Middle&quot;)] &lt;- NA

geneA_percent_into_exon &lt;- geneA_length_into_exon/
exon_num_per_transcript_per_breakpoint_geneA$EXONLENGTH
</code></pre>

<p>Now, we use the information about which exon each breakpoint matches up to plus whether the breakpoint falls at start/middle/end, to make a big data frame.</p>

<pre><code class="r">#&quot;Transcript other info&quot; has info like the biotype of the transcript, which we may want to display later on.
exon_num_per_transcript_per_breakpoint_geneA &lt;- data.frame(
Breakpoint = exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.coord,
Transcript = exon_num_per_transcript_per_breakpoint_geneA$TXNAME,
ExonicOrNot = &quot;yes&quot;,
ExonInOrBefore = exon_num_per_transcript_per_breakpoint_geneA$EXONRANK,
Breakpoint.name = exon_num_per_transcript_per_breakpoint_geneA$Breakpoint.name,
StartMiddleEnd = geneA_matching_exon_start_middle_end,LengthIntoExon = geneA_length_into_exon,PercentIntoExon = geneA_percent_into_exon,
Transcript.other.info = paste0(&quot;Transcript_gene_name=&quot;,exon_num_per_transcript_per_breakpoint_geneA$external_gene_name,&quot;;Transcript_biotype=&quot;,exon_num_per_transcript_per_breakpoint_geneA$transcript_biotype,&quot;;Transcript_CDS_length=&quot;,exon_num_per_transcript_per_breakpoint_geneA$cds_length,&quot;;Transcript_total_length=&quot;,exon_num_per_transcript_per_breakpoint_geneA$transcript_length),
stringsAsFactors=FALSE)

head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##   Breakpoint      Transcript ExonicOrNot ExonInOrBefore Breakpoint.name
## 1   75513166 ENST00000006777         yes              3    7:75513166:+
## 2   42054048 ENST00000219905         yes             21   15:42054048:+
## 3   42054560 ENST00000219905         yes             22   15:42054560:+
## 4   48263190 ENST00000225964         yes             50   17:48263190:-
## 5  190532671 ENST00000260952         yes              5   2:190532671:+
## 6   57275150 ENST00000262293         yes              9   17:57275150:+
##   StartMiddleEnd LengthIntoExon PercentIntoExon
## 1            End             NA              NA
## 2            End             NA              NA
## 3            End             NA              NA
## 4         Middle            192       0.7901235
## 5            End             NA              NA
## 6            End             NA              NA
##                                                                                                   Transcript.other.info
## 1 Transcript_gene_name=RHBDD2;Transcript_biotype=protein_coding;Transcript_CDS_length=1095;Transcript_total_length=1802
## 2   Transcript_gene_name=MGA;Transcript_biotype=protein_coding;Transcript_CDS_length=9198;Transcript_total_length=12042
## 3   Transcript_gene_name=MGA;Transcript_biotype=protein_coding;Transcript_CDS_length=9198;Transcript_total_length=12042
## 4 Transcript_gene_name=COL1A1;Transcript_biotype=protein_coding;Transcript_CDS_length=4395;Transcript_total_length=6727
## 5 Transcript_gene_name=ASNSD1;Transcript_biotype=protein_coding;Transcript_CDS_length=1932;Transcript_total_length=2450
## 6  Transcript_gene_name=PRR11;Transcript_biotype=protein_coding;Transcript_CDS_length=1083;Transcript_total_length=2332
</code></pre>

<pre><code class="r">#Add the total number of exons per transcript.

exon_num_per_transcript_per_breakpoint_geneA &lt;- merge(exon_num_per_transcript_per_breakpoint_geneA,
total_exons_per_transcript,
by.x=&quot;Transcript&quot;,by.y=&quot;TXNAME&quot;)

head(exon_num_per_transcript_per_breakpoint_geneA)
</code></pre>

<pre><code>##        Transcript Breakpoint ExonicOrNot ExonInOrBefore Breakpoint.name
## 1 ENST00000006777   75513166         yes              3    7:75513166:+
## 2 ENST00000219905   42054048         yes             21   15:42054048:+
## 3 ENST00000219905   42054560         yes             22   15:42054560:+
## 4 ENST00000225964   48263190         yes             50   17:48263190:-
## 5 ENST00000260952  190532671         yes              5   2:190532671:+
## 6 ENST00000262293   57275150         yes              9   17:57275150:+
##   StartMiddleEnd LengthIntoExon PercentIntoExon
## 1            End             NA              NA
## 2            End             NA              NA
## 3            End             NA              NA
## 4         Middle            192       0.7901235
## 5            End             NA              NA
## 6            End             NA              NA
##                                                                                                   Transcript.other.info
## 1 Transcript_gene_name=RHBDD2;Transcript_biotype=protein_coding;Transcript_CDS_length=1095;Transcript_total_length=1802
## 2   Transcript_gene_name=MGA;Transcript_biotype=protein_coding;Transcript_CDS_length=9198;Transcript_total_length=12042
## 3   Transcript_gene_name=MGA;Transcript_biotype=protein_coding;Transcript_CDS_length=9198;Transcript_total_length=12042
## 4 Transcript_gene_name=COL1A1;Transcript_biotype=protein_coding;Transcript_CDS_length=4395;Transcript_total_length=6727
## 5 Transcript_gene_name=ASNSD1;Transcript_biotype=protein_coding;Transcript_CDS_length=1932;Transcript_total_length=2450
## 6  Transcript_gene_name=PRR11;Transcript_biotype=protein_coding;Transcript_CDS_length=1083;Transcript_total_length=2332
##   TotalExonNum
## 1            4
## 2           24
## 3           24
## 4           51
## 5            6
## 6           10
</code></pre>

<p>Not shown - set up similarly for geneB and introns for both geneA and geneB.</p>

<pre><code>## Error in data.frame(Breakpoint = introns_geneA_find_exon_before$Breakpoint.coord, : object &#39;introns_geneA_find_exon_before&#39; not found
</code></pre>

<pre><code>## Error in merge(introns_geneA_find_exon_before, total_exons_per_transcript, : object &#39;introns_geneA_find_exon_before&#39; not found
</code></pre>

<p>Combine the exon and intron tables.</p>

<pre><code class="r">geneA_representative_transcripts_per_breakpoint &lt;- rbind(exon_num_per_transcript_per_breakpoint_geneA,introns_geneA_find_exon_before)
</code></pre>

<pre><code>## Error in eval(quote(list(...)), env): object &#39;introns_geneA_find_exon_before&#39; not found
</code></pre>

<pre><code class="r">geneB_representative_transcripts_per_breakpoint &lt;- rbind(exon_num_per_transcript_per_breakpoint_geneB,introns_geneB_find_exon_before)
</code></pre>

<p>Bind the match-up to transcripts to the other info (descriptions, predicted effect, etc.).</p>

<pre><code class="r">fusion_file_main_info_incompatible_annotation &lt;- fusion_file_main_info[incompatible_annotation_rows,]

fusion_file_main_info &lt;- fusion_file_main_info[setdiff(1:nrow(fusion_file_main_info),incompatible_annotation_rows),]

fusion_file_main_info_match_up_geneA &lt;- merge(fusion_file_main_info,
geneA_representative_transcripts_per_breakpoint,
by.x = &quot;GeneA.Breakpoint&quot;,by.y = &quot;Breakpoint.name&quot;)
</code></pre>

<pre><code>## Error in merge(fusion_file_main_info, geneA_representative_transcripts_per_breakpoint, : object &#39;geneA_representative_transcripts_per_breakpoint&#39; not found
</code></pre>

<pre><code class="r">fusion_file_main_info_match_up_geneB &lt;- merge(fusion_file_main_info,
geneB_representative_transcripts_per_breakpoint,
by.x = &quot;GeneB.Breakpoint&quot;,by.y = &quot;Breakpoint.name&quot;)

#Order geneA and geneB info by the same combination of breakpoints in fusion_file_main_info so they match up.

fusion_file_main_info_match_up_geneA &lt;- fusion_file_main_info_match_up_geneA[match(
paste0(fusion_file_main_info$GeneA.Breakpoint,&quot;/&quot;,fusion_file_main_info$GeneB.Breakpoint),
paste0(fusion_file_main_info_match_up_geneA$GeneA.Breakpoint,&quot;/&quot;,fusion_file_main_info_match_up_geneA$GeneB.Breakpoint)),]
</code></pre>

<pre><code>## Error in eval(expr, envir, enclos): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code class="r">fusion_file_main_info_match_up_geneB &lt;- fusion_file_main_info_match_up_geneB[match(paste0(fusion_file_main_info$GeneA.Breakpoint,&quot;/&quot;,fusion_file_main_info$GeneB.Breakpoint),paste0(fusion_file_main_info_match_up_geneB$GeneA.Breakpoint,&quot;/&quot;,fusion_file_main_info_match_up_geneB$GeneB.Breakpoint)),]

#Last minor detail: multiply PercentIntoExon by 100, as it is actually currently a proportion in range 0-1.

fusion_file_main_info_match_up_geneA$PercentIntoExon &lt;- fusion_file_main_info_match_up_geneA$PercentIntoExon*100
</code></pre>

<pre><code>## Error in eval(expr, envir, enclos): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code class="r">fusion_file_main_info_match_up_geneB$PercentIntoExon &lt;- fusion_file_main_info_match_up_geneB$PercentIntoExon*100

head(fusion_file_main_info)
</code></pre>

<pre><code>##     GeneA.GeneB
## 1    MGA--NUTM1
## 2    MGA--NUTM1
## 3 FAM175A--HELQ
## 4 FAM175A--HELQ
## 5 FAM175A--HELQ
## 6 FAM175A--HELQ
##                                                        FusionDescription
## 1                                                                       
## 2                                                                       
## 3 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 4 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 5 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 6 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
##   GeneA.Breakpoint GeneB.Breakpoint In.frame.status
## 1    15:42054560:+    15:34640170:+        in-frame
## 2    15:42054048:+    15:34640170:+        in-frame
## 3     4:84384647:-     4:84375098:-    Not in-frame
## 4     4:84397796:-     4:84375098:-    Not in-frame
## 5     4:84403307:-     4:84375098:-        in-frame
## 6     4:84391356:-     4:84375098:-    Not in-frame
##                                             Other.breakpoint.specific.info
## 1    Spanning.pairs=146;Spanning.unique.reads=37;Predicted.effect=in-frame
## 2     Spanning.pairs=146;Spanning.unique.reads=4;Predicted.effect=in-frame
## 3 Spanning.pairs=27;Spanning.unique.reads=16;Predicted.effect=out-of-frame
## 4  Spanning.pairs=27;Spanning.unique.reads=2;Predicted.effect=out-of-frame
## 5      Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=in-frame
## 6  Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=out-of-frame
</code></pre>

<pre><code class="r">head(fusion_file_main_info_match_up_geneA)
</code></pre>

<pre><code>## Error in head(fusion_file_main_info_match_up_geneA): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code class="r">head(fusion_file_main_info_match_up_geneB)
</code></pre>

<pre><code>##    GeneB.Breakpoint   GeneA.GeneB
## 36    15:34640170:+    MGA--NUTM1
## 37    15:34640170:+    MGA--NUTM1
## 80     4:84375098:- FAM175A--HELQ
## 81     4:84375098:- FAM175A--HELQ
## 82     4:84375098:- FAM175A--HELQ
## 83     4:84375098:- FAM175A--HELQ
##                                                         FusionDescription
## 36                                                                       
## 37                                                                       
## 80 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 81 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 82 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
## 83 adjacent,known,healthy,cacg,bodymap2,hpa,banned,1K&lt;gap&lt;10K,readthrough
##    GeneA.Breakpoint In.frame.status
## 36    15:42054560:+        in-frame
## 37    15:42054048:+        in-frame
## 80     4:84384647:-    Not in-frame
## 81     4:84397796:-    Not in-frame
## 82     4:84403307:-        in-frame
## 83     4:84391356:-    Not in-frame
##                                              Other.breakpoint.specific.info
## 36    Spanning.pairs=146;Spanning.unique.reads=37;Predicted.effect=in-frame
## 37     Spanning.pairs=146;Spanning.unique.reads=4;Predicted.effect=in-frame
## 80 Spanning.pairs=27;Spanning.unique.reads=16;Predicted.effect=out-of-frame
## 81  Spanning.pairs=27;Spanning.unique.reads=2;Predicted.effect=out-of-frame
## 82      Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=in-frame
## 83  Spanning.pairs=27;Spanning.unique.reads=1;Predicted.effect=out-of-frame
##         Transcript Breakpoint ExonicOrNot ExonInOrBefore StartMiddleEnd
## 36 ENST00000537011   34640170         yes              3          Start
## 37 ENST00000537011   34640170         yes              3          Start
## 80 ENST00000295488   84375098         yes              2            End
## 81 ENST00000295488   84375098         yes              2            End
## 82 ENST00000295488   84375098         yes              2            End
## 83 ENST00000295488   84375098         yes              2            End
##    LengthIntoExon PercentIntoExon
## 36             NA              NA
## 37             NA              NA
## 80             NA              NA
## 81             NA              NA
## 82             NA              NA
## 83             NA              NA
##                                                                                                   Transcript.other.info
## 36 Transcript_gene_name=NUTM1;Transcript_biotype=protein_coding;Transcript_CDS_length=3483;Transcript_total_length=4102
## 37 Transcript_gene_name=NUTM1;Transcript_biotype=protein_coding;Transcript_CDS_length=3483;Transcript_total_length=4102
## 80  Transcript_gene_name=HELQ;Transcript_biotype=protein_coding;Transcript_CDS_length=3306;Transcript_total_length=3579
## 81  Transcript_gene_name=HELQ;Transcript_biotype=protein_coding;Transcript_CDS_length=3306;Transcript_total_length=3579
## 82  Transcript_gene_name=HELQ;Transcript_biotype=protein_coding;Transcript_CDS_length=3306;Transcript_total_length=3579
## 83  Transcript_gene_name=HELQ;Transcript_biotype=protein_coding;Transcript_CDS_length=3306;Transcript_total_length=3579
##    TotalExonNum
## 36            8
## 37            8
## 80           18
## 81           18
## 82           18
## 83           18
</code></pre>

<pre><code class="r">#Save objects.

save(list=c(&quot;fusion_file&quot;,&quot;fusion_program&quot;,&quot;genome&quot;,&quot;output_dir&quot;,&quot;fusion_file_main_info_incompatible_annotation&quot;,&quot;fusion_file_main_info&quot;,&quot;fusion_file_main_info_match_up_geneA&quot;,&quot;fusion_file_main_info_match_up_geneB&quot;),file=paste0(output_dir,&quot;/overlaps_breakpoints_and_transcripts.Rdata&quot;))
</code></pre>

<pre><code>## Error in save(list = c(&quot;fusion_file&quot;, &quot;fusion_program&quot;, &quot;genome&quot;, &quot;output_dir&quot;, : object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<p>Final step in annotation is to match up UTR table.</p>

<p>utrs_data_frame_for_plotting contains 5&#39; and 3&#39; UTRs for all annotated transcripts.</p>

<p>Subset it to include only transcripts being used to represent our fusions.</p>

<pre><code class="r">fiveprime_utrs &lt;- utrs_data_frame_for_plotting[order(utrs_data_frame_for_plotting$ExonInOrBefore),]
fiveprime_utrs &lt;- fiveprime_utrs[which(duplicated(fiveprime_utrs$Transcript) == FALSE),]
rownames(fiveprime_utrs) &lt;- fiveprime_utrs$Transcript

threeprime_utrs &lt;- utrs_data_frame_for_plotting[order(utrs_data_frame_for_plotting$ExonInOrBefore,decreasing=TRUE),]
threeprime_utrs &lt;- threeprime_utrs[which(duplicated(threeprime_utrs$Transcript) == FALSE),]
rownames(threeprime_utrs) &lt;- threeprime_utrs$Transcript

fiveprime_utrs &lt;- fiveprime_utrs[unique(c(fusion_file_main_info_match_up_geneA$Transcript,fusion_file_main_info_match_up_geneB$Transcript)),]
</code></pre>

<pre><code>## Error in unique(c(fusion_file_main_info_match_up_geneA$Transcript, fusion_file_main_info_match_up_geneB$Transcript)): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code class="r">threeprime_utrs &lt;- threeprime_utrs[unique(c(fusion_file_main_info_match_up_geneA$Transcript,fusion_file_main_info_match_up_geneB$Transcript)),]
</code></pre>

<pre><code>## Error in unique(c(fusion_file_main_info_match_up_geneA$Transcript, fusion_file_main_info_match_up_geneB$Transcript)): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<p>Here are the functions to make the initial plot (draw the boxes, make the plot the appropriate width) and to draw breakpoint lines.</p>

<p>Only thing is I no longer leave room for the coverage bars, so the y coordinates are different than they were. For example, the exons bars are now around y coordinates 8/9 rather than 6/7.</p>

<pre><code class="r">setup_fusion_plot &lt;- function(exon_num){

#Plot will go from y=1 to y=10, and x=0 to x=120*(exon_num - 1)+200.
#The plot x-limit is based on the fact that the exons will be 101 bp, and the introns will be 20bp, plus a little extra room to put text, legends, etc.
#Then we can use the standard coordinate system to place things. For example, if we want something near the top but not quite, and in the middle, setting the x coordinate as half the plot max,
#and the y coordinate at 9.5 out of 10, should work well.

plot_xmax &lt;- 120*(exon_num - 1)+200

plot(0,pch=&#39;&#39;,ylab=&#39;&#39;,xlab=&#39;&#39;,xlim=c(0,plot_xmax),ylim=c(0,10),xaxt = &#39;n&#39;,yaxt = &#39;n&#39;,bty=&#39;n&#39;)

for(exon in 0:(exon_num - 1))
{
rect(120*exon,8.5,(120*exon)+100,9.25)
end_this_exon &lt;- (120*exon)+100
if(exon &lt; (exon_num - 1)){lines(c(end_this_exon,end_this_exon+20),c(8.875,8.875),type=&quot;l&quot;)}
}

}

#We are calling this draw_breakpoint, but will actually use the same function to draw UTR lines.
#In this iteration of the script I am going back to drawing fusion breakpoints in orange and UTR lines in blue.
#Of course we will eventually want to draw UTRs as smaller boxes.

draw_breakpoint &lt;- function(breakpoint_info_data_frame,mycolor){

exon_index &lt;- breakpoint_info_data_frame$ExonInOrBefore - 1
breakpoint_type &lt;- breakpoint_info_data_frame$StartMiddleEnd

exon_of_interest_start_coordinate &lt;- 120*exon_index

if(breakpoint_type == &quot;Start&quot;){breakpoint_x_coordinate_on_plot &lt;- exon_of_interest_start_coordinate}
if(breakpoint_type == &quot;End&quot;){breakpoint_x_coordinate_on_plot &lt;- exon_of_interest_start_coordinate + 100}
if(breakpoint_type == &quot;Intronic&quot;){breakpoint_x_coordinate_on_plot &lt;- exon_of_interest_start_coordinate + 110}
if(breakpoint_type == &quot;Middle&quot;)
{
breakpoint_x_coordinate_on_plot &lt;- exon_of_interest_start_coordinate + (breakpoint_info_data_frame$PercentIntoExon/100)*101
}

lines(c(breakpoint_x_coordinate_on_plot,breakpoint_x_coordinate_on_plot),c(8.35,9.4),col=mycolor,lwd=2)

}
</code></pre>

<p>Now, run through each line from the fusion program and output the visualization.</p>

<p>Here I make the size 12 inches wide x 8 inches high. But really any size is fine, although a fairly high width:height ratio will display better here.</p>

<pre><code class="r">pdf(paste0(output_dir,&quot;/fusion_visualization.pdf&quot;),width=12,height=8)

par(mfrow=c(1,2))
par(mai = c(1, 0.5, 0.1, 0.1))

#We only plot for rows in the fusion file that do not have descriptions &quot;healthy&quot;,&quot;readthrough&quot;, or &quot;banned&quot; by default.
#If we want to plot all outputs, then do for i in 1:nrow(fusion_file_main_info).

for(i in grep(&#39;healthy|readthrough|banned&#39;,as.vector(fusion_file_main_info$FusionDescription),perl=TRUE,invert=TRUE))
{
#Make plot for geneA with the appropriate number of exons (boxes).
setup_fusion_plot(fusion_file_main_info_match_up_geneA$TotalExonNum[i])
#Now, draw the breakpoint at the appropriate x coordinate.
draw_breakpoint(fusion_file_main_info_match_up_geneA[i,c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;orange&quot;)
#Check if the transcript has a 5&#39; and 3&#39; UTR.
#If so, also draw blue lines for the UTRs.
if(fusion_file_main_info_match_up_geneA$Transcript[i] %in% rownames(fiveprime_utrs)){
        draw_breakpoint(fiveprime_utrs[fusion_file_main_info_match_up_geneA$Transcript[i],c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;blue&quot;)
}
if(fusion_file_main_info_match_up_geneA$Transcript[i] %in% rownames(threeprime_utrs)){
        draw_breakpoint(threeprime_utrs[fusion_file_main_info_match_up_geneA$Transcript[i],c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;blue&quot;)
}
#Plot was set up so the x coordinates go from 0 to 120*(ExonNum - 1)+200.
#We set the x coordinates of all text at half this so it will be around the middle.
plot_xmax &lt;- 120*(fusion_file_main_info_match_up_geneA$TotalExonNum[i] - 1)+200
#Put text including the gene name, description, etc.
text(plot_xmax/2,7,fusion_file_main_info_match_up_geneA$GeneA.GeneB[i])
text(plot_xmax/2,6.5,fusion_file_main_info_match_up_geneA$FusionDescription[i],cex=0.75)
text(plot_xmax/2,5.5,gsub(&#39;\\;&#39;,&#39;\n&#39;,fusion_file_main_info_match_up_geneA$Other.breakpoint.specific.info[i]),cex=0.75)
text(plot_xmax/2,4.5,paste0(&quot;GeneA.transcript=&quot;,fusion_file_main_info_match_up_geneA$Transcript[i],&quot;\nGeneB.transcript=&quot;,fusion_file_main_info_match_up_geneB$Transcript[i]),cex=0.75)
#Now, plot geneB.
setup_fusion_plot(fusion_file_main_info_match_up_geneB$TotalExonNum[i])
draw_breakpoint(fusion_file_main_info_match_up_geneB[i,c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;orange&quot;)
if(fusion_file_main_info_match_up_geneB$Transcript[i] %in% rownames(fiveprime_utrs)){
        draw_breakpoint(fiveprime_utrs[fusion_file_main_info_match_up_geneB$Transcript[i],c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;blue&quot;)
}
if(fusion_file_main_info_match_up_geneB$Transcript[i] %in% rownames(threeprime_utrs)){
        draw_breakpoint(threeprime_utrs[fusion_file_main_info_match_up_geneB$Transcript[i],c(&quot;ExonInOrBefore&quot;,&quot;StartMiddleEnd&quot;,&quot;PercentIntoExon&quot;)],&quot;blue&quot;)
}
#Plot xmax wil be different for geneB if there are a different number of exons.
#Currently all text is on the left side, but will likely change this later when add protein domains.
plot_xmax &lt;- 120*(fusion_file_main_info_match_up_geneB$TotalExonNum[i] - 1)+200
text(plot_xmax/2,7,&quot;Will add some text to geneB plot later on,\nprobably related to protein domains&quot;)
}

dev.off()
</code></pre>

<pre><code>## Error in setup_fusion_plot(fusion_file_main_info_match_up_geneA$TotalExonNum[i]): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code>## Error in draw_breakpoint(fusion_file_main_info_match_up_geneA[i, c(&quot;ExonInOrBefore&quot;, : object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code>## Error in fusion_file_main_info_match_up_geneA$Transcript[i] %in% rownames(fiveprime_utrs): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code>## Error in fusion_file_main_info_match_up_geneA$Transcript[i] %in% rownames(threeprime_utrs): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code>## Error in eval(expr, envir, enclos): object &#39;fusion_file_main_info_match_up_geneA&#39; not found
</code></pre>

<pre><code>## Error in text(plot_xmax/2, 7, fusion_file_main_info_match_up_geneA$GeneA.GeneB[i]): object &#39;plot_xmax&#39; not found
</code></pre>

<pre><code>## Error in text(plot_xmax/2, 6.5, fusion_file_main_info_match_up_geneA$FusionDescription[i], : object &#39;plot_xmax&#39; not found
</code></pre>

<pre><code>## Error in text(plot_xmax/2, 5.5, gsub(&quot;\\;&quot;, &quot;\n&quot;, fusion_file_main_info_match_up_geneA$Other.breakpoint.specific.info[i]), : object &#39;plot_xmax&#39; not found
</code></pre>

<pre><code>## Error in text(plot_xmax/2, 4.5, paste0(&quot;GeneA.transcript=&quot;, fusion_file_main_info_match_up_geneA$Transcript[i], : object &#39;plot_xmax&#39; not found
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAIAAAApSmgoAAAACXBIWXMAAAsSAAALEgHS3X78AAAWF0lEQVR4nO3df2zV9b348fcp0Kv4A0pppcYNg+jmlg0zdMvYgC2AysQFEzd11DIFHUa3LLtxREVn8AaHTsVN3Ex0wZhNnGZ3t1u2xR/5bhku7oqSCXPW+JMhUJBSsFBaaM/3j7N71vTH6TmHH4XXHo+/Ts/5nPfn/TnHPCmH+momm80mAOKqGOoNAHB4CT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwR3rIa+szNt3nzolst2pz0bD91ylGzjxtTVNdSbgKCO1dDffXc655xDt9y7q1PjGamz9dCtSAna29OZZ6ZHHx3qfUBQx2ro29rSBx8cuuUOfJCyB1JX+6FbkRJ0dKTOzrR791DvA4I6VkMPQJGEHiA4oQcITugBghs+1BtI3/zmN//4xz9WVlaW9KxNm67fv78+pREppWeeeWbhwoU1NTWlnrq5uXnjxo2ZTKa7u7sipQsvvPD9PSNKWmH79u2rVq364he/mFK64oormpqaKipK+7Ozo6Nj1qxZ9957b0rp8ccfX7JkSVVVVUkrpJT27du3YcOGlFJLS8snPvGJurq6Uldobm7+zW9+M2nSpJTSBRdcsGPHjlJX2LNnT319/S233JJS+tGPfvTAAw+cdNJJRT63q+uklP7fvffe+9RTv1yzZk2ppwYKG/rQt7a2/va3vz3ttNNKetZ//mfnihXZ/Arf/e53r7/++lJPPWPGjGw2mw/973//+3R8aYlcsWLFrl278tv485//fNxxx5W0wttvv33HHXfkV1i2bNlll11W0goppdyfNCmlffv2feELX/jZz35W6gq33Xbb7v/7qZfOzs61a9eWusKLL7745JNP5m63trY++OCDM2bMKPK5ra2pqip95zvf+Z//+XWp5wUG5aMbgOCEHiA4oQcITugBghN6gOCEHiA4oQcITugBghN6gOCEHiA4oQcITugBghv6oWYH46WXXkopvfXWW8OHl3Mh+/bte+mllyoqKqp2bJxQ1gb27dv35ptv5rbR1tZWxgrZbLalpSW3wsaNG0888cTytpFbYfv27e3t5fxCxPb29qamppEjR6aU9u7dW8YK3d3dzc3NuW1s3rz5wIEDZSwCHA7Hauiz2Ww2m3LjEl977bWPfvSjZSyyc+fOp556KpPJnFe1bsKHytnGtm3b3n333e3bt6eUtmzZks1mS12hvb397bffzl3IunXramtry9hGS0tLboW2trb333+/jBW2bdu2ZcuWN954I6WUu5xS7dq1q6mpKbeNv/3tb9OnTy9jEeBwOFZDn8lkMpn0/e9/P6X05JNPbtu2rYxF6urq7rzzzoqKigOvrUwvP1PGCh/+8IenTZs2d+7clNJf//rXTCZT6gojR46cPHly7kJ+/OMfjxkzpoxtnHrqqbkVNm/efOONN5axwvjx42fNmjV16tSU0l/+8pcyVqiqqpo2bVpuG3fccUcZvx4AOEx8Rg8QnNADBCf0AMEJPUBwQg8QnNADBCf0AMEJPUBwQg8QnNADBCf0AMEJPUBwR8VQswcffHDUqFElPeXFFz+f0nn5L5955pkypgS/++67Pb9cuXJlW9dJJa2wZs2aBQsW5L+85557Sh2Y3NLS0vPLxsbGd955p6QVUko9Z7q9+uqry5cvL3WF559/ftasWbnbnZ2dZaywadOm448/Pv/l6tWr165dW+Rz29v/I6VvP/fcc+WNegYKy5QxWffQev311zdu3Fjqsx55ZOJ///f4ffsyKaWdO3fmxqCXasSIEf+cpvvGQ+l/F/1p7BMdFSUPjzz33HNHjx6dUtqwYcPWrVvL2Mb48ePPPPPMlFJzc/P69evLWGHkyJFTpkxJKXV1df3hD38o7z397Gc/e8IJJ6SU1q1bt2PHjjJWmDhx4umnn55S2rRp02uvvVb8E9vahl9yyReuu+71q67add555w3+BKAUQx/68tx0U1qxIpX1Ozb688ZD6X8XpUs2p+PrDtGKlKC1NVVVpfvuS9/+9lBvBSLyGT1AcEIPEJzQAwR3DIe+9F/bV2ixQ74ixct4+eFwOip+vLIMl12WTjvt0C1Xd0Ga9F/pP8r5xdwcvFGj0p13pjlzhnofENSx+lM3ABTpGP7oBoBiCD1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPEJzQAwQn9ADBCT1AcEIPENwRDX1jY2Puxk9+8pPJkyenlDKZTO6evjeK1+9Tyljn31wmkxk+fPjw4cMrKysnT5788ssvF/msUs9S1u6A8h3R0D/77LO5Gy+88MK0adNSSosXLz6SGzjcZs6ceZDHl7rCoXXgwIEDBw60tbXNnz//6quvPvgFD/4FAQ5eJpvNHrGTnX322X//+99zN5YtW3bJJZf8ax+Zf+4kf6N4/T6ljHUOXqkn7Xv8kGy776k/+OCD0047bdeuXSU9q5hHSz0eOHhH9Dv6HTt2bNq0qbW1tamp6fOf/3wq7i/yjY2N55xzzujRo+vq6n7wgx+klFpaWubNm1ddXT1x4sQf/vCHucP6vbOnn/70p3V1dWPHjs092tLS0tDQUFdXd+qpp86fP7+lpSV3WCaTufnmm+vq6pYuXXr77befddZZo0aNWrZsWUpp69atX/nKV2praydMmNDQ0LBly5ae68+dOzeldM455/R72BNPPPG5z32uq6urtbX1zDPPXL9+ff74visMtLec3bt3L1iwYNy4cR/5yEceffTR3Gs40N4ymczq1asnTZpUXV29YsWKQa8ipdTe3v7QQw9deOGFve7PZDJ33XVXbW3t1KlT33nnnZ4P9bvhvhdY+G0t/ALmNvDYY4+NGzeu8Hl7XXW/Z4d/L9kj6PLLL1+1atXTTz999tln5+7Jb6DvjbxPfvKTd99994EDB15++eXKyspsNltfX/+1r31t165duQ8Zck/p986eRo8e/corrzQ1Nc2cOTObzV555ZULFizYu3fv3r17Fy5c+PWvfz2/gZ///OevvPJKSum+++7r6Oh4+umnjzvuuGw2O2fOnNWrV+/du3fnzp233377RRdd1OsUuZMOdFh9ff3y5csbGhruv//+gS42d89Ae8u59tprr7766j179rS3t1977bWFT5pSWr58eXd393PPPXf88ccXPjIvk8msW7eu795uvfXW/fv333TTTXPnzi1mwwNdYL9v66AvYErp+uuv37BhQ361AufNX3UW/u0d0dA//PDD8+bNW7p06Te+8Y1/nr6I0Hd1db3wwguPPPJIQ0ND7tExY8Zs2bIl92ju272B7uzpy1/+8pw5c37xi1/s378/m81WV1c3NzfnHtq6dWttbW1+Ax0dHd3d3Sml3JG529ls9oQTTuhZw5qaml6nKHxYa2vrGWeccf7553d3dw90sbl7BtpbTm1tbc9HC580pbR79+5itpffTGdn59133/3pT3+6797efPPNbDa7ffv2MWPGFLPhAqHv+7YWs8Nt27b1XK3AefNXDRzRj25mzJjx7LPP5v8ltkhf/epX77///pqamjvvvDN3T0XFv7ad//Cn3zt7+tWvfnXDDTf88pe/nD17dq/DMplMV1dX/sjKysrcQ8OHD+95WFVVVa502Wy2ra1t7dq1/W54oMP27NnT1dW1efPmjo6OQa96oL2llLq6uvKPDhs2bNC9nXTSScVsL2/EiBHz58/fsGHDQHurqKjotaXCG+5X37e1mB3W1NQUed5eVw3/1o7snyvZiRMnjhgxYuPGjbkvUxHf0Z988skbNmzo7u5+5JFHUkr79+9vaGiYN2/e7t2729rarrrqqtxT+r2zp/Hjxzc1Nb366qtVVVXZbLa+vv6aa65pb2/P/a3/yiuvLLCT3O1vfetbCxcu3LNnT3Nz84wZMxYtWtTrFCmlzs7Ofg/r6uqaOXPmE088sWjRohtvvLHn8X1XGGhvOfPnz1+4cOHevXvb29uvu+66wnsr/iryR3Z3d69atepTn/pU36tbsmTJ/v37lyxZcvHFF/d8VoEXs+8FDvS2Fn4Bs/39tzHomwhkj/BHN9lsdtGiRaeffvq/Tl9E6B944IGxY8d+/OMfv+uuuy644IKGhoYdO3ZcccUVY8aMmTBhwqpVq3JP6ffOnlauXDlmzJja2tqHH344m82+//779fX1p5xyyrhx43JrFthJ7vbu3buvuuqq2trasWPHLliwoK2trdcpvvSlL33oQx/q97B77rnn8ssvzy1yxhln/OlPf8of33eFgfaW09LSUl9fX11d/bGPfeyxxx4bNWpUgb0VfxUppWHDhg0bNqyiomLChAnPP/98r6tLKS1evLi6unrKlClvvfVWzzUH2nDfC8zvp+/bWvgFzPb338agbyKQzWb9NNuxp7GxcdKkSePHj08pNTU1XXzxxa+//voROK+ffYRjlBEIx541a9bccMMN27Zte++99xYvXnzppZcO9Y6Ao5rQH3tuu+220aNHn3XWWeeee+4pp5xy8803H5nzPv7440fmRMCh5S/jAMH5jh4gOKEHCO7YDn3xM28P3yjjQzV396ia33uohkUf4T0A/Tq2Q3/0O5i5u4d1Zm/hxY+G8dFHwx4ghmP7H2OL/8nuwzfK+FDN3T3CI4sP+eJ+yh6OWkfLd/T9jsDNj6UtMLb3e9/7Xk1NzZQpU954443cPX3n3w50ZM4111xz33335W4vWLDg3nvv7bWx3B4Gne5b6tzdwnOVixxZXN5LV8xA4PyNXlOO8wYaFl3q8OeB3rLCe+g1dBooZEj+f9y+0gAjcHNjaQtMo81NX7nppptmz56du3Og+bd9j8xd/u9+97upU6dms9l9+/ZVV1e/9957vTaW20OB2bmFz5sdYO7uoHOVUxEjiw/mpRtoYz0vKvWZcpzX7/7LGP5c+KUbaA+9hk4DBRxFoe93BG5uLG2BabT5Z5188sm5Oweaf9v3yNyjHR0d1dXVW7dubWxs7FuN/B4Gne5b6tzdQecqpyJGFh/MS1fMRaU+U47z+t1/GcOfC790A+2h19BpoICj5aObvF4jcPNjaQtPwa2oqBgxYkTudoH5t72OzKmsrLzooosaGxtXr15dX1/f9ym5PQw63bfUubuDzlXu+2jhCcBlvHTFDF4eaN7vQPsvdfhzGuwt63cPfYdOAwMamj9f+kgDj8DNFpxGm/vU4pZbbrn00ktzdw40/7bvkfn1Gxsbp0+fXlNTs2vXrr4by90YdHZuqXN3B52rnIoYWXwwL10xA4F77qrXDvvdfxnDnwu8dAWe0mvoNFDAURT6gUbgZgtOo126dOnYsWOnT5+en3Hf7/zbfo/Mr9/e3n7iiSdedtll/W4sd2PQ2bmlzt0ddK5yMSOLy37pihwIXCD0/e6/jOHPBd6yAk/pNXQaKOBo+ZG4If/hvM985jO33nrrnDlzhnAP5Rnylw44yg0f6g0Mvf37969fv/4f//jH+eefP9R7ATj0jpZ/jB3CEbi//vWvZ8+evXLlysrKyqHaw8EwPRgozN/6AYI7Wr6jB+AwEXqA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeIDihBwhO6AGCE3qA4IQeILj/D++hKNAQJjNOAAAAAElFTkSuQmCC" alt="plot of chunk unnamed-chunk-34"/></p>

</body>

</html>
